---
title: "Mini-Project 2"
author: "Your Name Here"
date: "October 31, 2017"
output: html_document
---
=======
>>>>>>> 4759b1f54f9b57a815caa8140d7cdf1da8ce1033
## Loading the data

```{r, include=FALSE}
load("house_elections.rda")
load("candidates.rda")
load("committees.rda")
load("contributions.rda")
```

```{r}
library(tidyverse)
library(gridExtra)
library(cowplot)
library(grid)
```
pull down, make changes, save file, git, stage file (click the check), commit, pull, push 

```{r}
test2<-contributions%>%
  inner_join(house_elections, by=c("cand_id"="fec_id"))

test3<-test2%>%
  inner_join(candidates, by="cand_id")
```

```{r}
total<-test3%>%
  group_by(cand_id, cand_name, cand_party_affiliation)%>%
  mutate(posneg=ifelse(transaction_amt>0, "positive","negative"))
```

```{r}
totalcont<-total%>%
  group_by(cand_id, cand_name)%>%
  summarise(against=sum(ifelse(posneg=="negative", transaction_amt, 0)),
            support=sum(ifelse(posneg=="positive", transaction_amt, 0)))
```

```{r}
outcome<-totalcont%>%
  left_join(house_elections, by=c("cand_id"="fec_id"))

top50<-outcome%>%
  arrange(desc(support))%>%
  head(50)

mostagainst<-outcome%>%
  arrange(desc(against))%>%
  head(50)
```

```{r}
final <- outcome %>%
  arrange(desc(general_votes)) %>%
  head(50)
final$cand_name <- factor(final$cand_name, levels = final$cand_name[order(final$support)])


testplot <- ggplot(final, aes(x = cand_name, y = support, fill=party)) +
  geom_bar(stat="identity") +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_text(size = 9),
        axis.title.y = element_blank(),
        axis.text.y = element_text(size = 5.5), 
        axis.ticks.y = element_blank(), 
        plot.margin = unit(c(2,0,3,3), "mm")) +
  
  scale_y_reverse() +
  coord_flip()+
  scale_y_continuous(breaks=c(0, 1000000,2000000,3000000), labels=c("0", "1M", "2M", "3M"))

testplot2 <- ggplot(final, aes(x = cand_name, y = against, fill=party)) +
  geom_bar(stat="identity") +
  theme(axis.title.x = element_blank(),
        axis.text.x = element_text(size = 9),
        axis.text.y = element_blank(),
        axis.title.y = element_blank(), 
        axis.ticks.y = element_blank(), 
        plot.margin = unit(c(2,-4,3,0), "mm")) +
  scale_fill_discrete(guide=FALSE)+
  coord_flip() +
  scale_y_continuous(breaks=c(0, -100000, -200000), limits=c(-600000,0), labels=c("0", "-100K", "-200K" ))

plot_grid(testplot2, testplot, ncol = 2)
```

```{r}
final <- outcome %>%
  arrange(desc(general_votes)) %>%
  head(50)
final$cand_name <- factor(final$cand_name, levels = final$cand_name[order(final$support)])

gather(final, key="cand_name")

testplot <- ggplot(final, aes(x = cand_name, y = support, fill=party)) +
  geom_bar(stat="identity") +
  theme(axis.title.x = element_blank(), 
        axis.text.x = element_text(size = 9),
        axis.title.y = element_blank(),
        axis.text.y = element_text(size = 5.5), 
        axis.ticks.y = element_blank(), 
        plot.margin = unit(c(2,0,3,3), "mm")) +
   scale_y_reverse() +
  coord_flip()+
  scale_y_continuous(breaks=c(0, 1000000,2000000,3000000), labels=c("0", "1M", "2M", "3M"))

testplot2 <- ggplot(final, aes(x = cand_name, y = against, fill=party)) +
  geom_bar(stat="identity") +
  theme(axis.title.x = element_blank(),
        axis.text.x = element_text(size = 9),
        axis.text.y = element_blank(),
        axis.title.y = element_blank(), 
        axis.ticks.y = element_blank(), 
        plot.margin = unit(c(2,3,3,0), "mm")) +
  scale_fill_discrete(guide=FALSE)+
  coord_flip() +
  scale_y_continuous(breaks=c(0, -50000, -100000, -150000))

plot_grid(testplot2, testplot, ncol = 2)
```